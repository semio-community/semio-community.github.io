{"version":3,"file":"EventsSections.BppNYh5z.js","sources":["../../src/components/events/EventsSections.tsx"],"sourcesContent":["import React, { useMemo, useState, useRef, useEffect } from \"react\";\nimport { EventCard } from \"@/components/cards/EventCard\";\nimport Section from \"@/components/sections/Section\";\nimport type { ImageLike, ImagePolicy } from \"@/utils/images\";\n\ntype LinkMap = {\n  website?: string;\n  registration?: string;\n  program?: string;\n  proceedings?: string;\n  recordings?: string;\n};\n\ntype Location = {\n  city?: string;\n  country?: string;\n  online?: boolean;\n};\n\ntype ImageRef = ImageLike;\n\nexport type SerializedEvent = {\n  id: string;\n  data: {\n    name?: string;\n    displayName?: string;\n    description?: string;\n    type: string;\n    startDate: string | Date;\n    endDate?: string | Date;\n    featured?: boolean;\n    links?: LinkMap;\n    location?: Location;\n    imagePolicy?: ImagePolicy;\n    images?: {\n      logo?: ImageRef;\n      hero?: ImageRef;\n    };\n  };\n};\n\nexport interface EventsSectionsProps {\n  // Provide all events (past, current, upcoming) as JSON string to avoid prop serialization issues.\n  eventsPayload: string;\n  // Optionally control how many items are initially shown in Featured and Past sections (no \"Show more\" UI here).\n  initialFeaturedCount?: number;\n  initialPastCount?: number;\n  className?: string;\n}\n\n/**\n * EventsSections\n *\n * Client-rendered events listing that computes Featured / Upcoming / Past at runtime (request-time),\n * so event placements won't be frozen at build-time.\n *\n * How sections are determined:\n * - Featured: all \"currently happening\" events (regardless of .featured flag) PLUS any future events with data.featured === true.\n * - Upcoming: events with endDate >= now, sorted ascending by startDate and grouped by start year.\n * - Past: events with endDate < now, sorted descending by startDate.\n */\ntype ExpandableGridProps<T> = {\n  items: T[];\n  initialCount: number;\n  viewAllText: string;\n  renderItem: (item: T, index: number) => React.ReactNode;\n};\n\nconst ExpandableGrid = <T extends { id: string }>({\n  items,\n  initialCount,\n  viewAllText,\n  renderItem,\n}: ExpandableGridProps<T>) => {\n  const [expanded, setExpanded] = useState(false);\n  const sectionRef = useRef<HTMLDivElement>(null);\n\n  const didMountRef = useRef(false);\n  const prevExpandedRef = useRef(expanded);\n\n  useEffect(() => {\n    if (!didMountRef.current) {\n      didMountRef.current = true;\n      prevExpandedRef.current = expanded;\n      return;\n    }\n    // Only scroll when collapsing from expanded -> collapsed\n    if (prevExpandedRef.current && !expanded && sectionRef.current) {\n      const top =\n        sectionRef.current.getBoundingClientRect().top + window.scrollY - 100;\n      window.scrollTo({ top, behavior: \"smooth\" });\n    }\n    prevExpandedRef.current = expanded;\n  }, [expanded]);\n\n  return (\n    <div\n      ref={sectionRef}\n      data-expandable-section\n      data-initial-count={initialCount.toString()}\n    >\n      <div\n        className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\"\n        data-items-container\n      >\n        {items.map((item, index) => (\n          <div\n            key={(item as any).id ?? index}\n            data-expandable-item\n            data-index={index}\n            className={index >= initialCount && !expanded ? \"hidden\" : \"\"}\n          >\n            {renderItem(item, index)}\n          </div>\n        ))}\n      </div>\n\n      {items.length > initialCount && (\n        <div className=\"text-center mt-6\">\n          <button\n            data-expand-button\n            onClick={() => setExpanded((v) => !v)}\n            className=\"inline-flex items-center gap-2 px-6 py-3 bg-accent-base/10 hover:bg-accent-base/20 rounded-lg font-medium text-accent-base transition-all\"\n          >\n            <span data-expand-text className={expanded ? \"hidden\" : \"\"}>\n              {viewAllText}\n            </span>\n            <span data-collapse-text className={expanded ? \"\" : \"hidden\"}>\n              Show Less\n            </span>\n            <svg\n              className=\"w-4 h-4 transition-transform\"\n              data-expand-icon\n              style={{\n                transform: expanded ? \"rotate(180deg)\" : \"rotate(0deg)\",\n              }}\n              viewBox=\"0 0 24 24\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              aria-hidden=\"true\"\n            >\n              <path\n                d=\"M12 15l-4-4h8l-4 4z\"\n                strokeWidth=\"1.5\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              />\n            </svg>\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport const EventsSections: React.FC<EventsSectionsProps> = ({\n  eventsPayload,\n  initialFeaturedCount = 6,\n  initialPastCount = 6,\n  className,\n}) => {\n  const events = useMemo(\n    () => JSON.parse(eventsPayload) as SerializedEvent[],\n    [eventsPayload],\n  );\n  const now = useMemo(() => new Date(), []);\n\n  const toDate = (d?: string | Date) =>\n    d ? (d instanceof Date ? d : new Date(d)) : undefined;\n\n  const computeStatus = (e: SerializedEvent) => {\n    const start = toDate(e.data.startDate)!;\n    const end = toDate(e.data.endDate) ?? start;\n    if (now > end) return \"past\" as const;\n    if (now >= start && now <= end) return \"ongoing\" as const;\n    return \"upcoming\" as const;\n  };\n\n  const normalizeForCard = (e: SerializedEvent) => ({\n    ...e,\n    data: {\n      ...e.data,\n      startDate: toDate(e.data.startDate)!,\n      endDate: toDate(e.data.endDate),\n    },\n  });\n\n  const { featuredEvents, upcomingEvents, pastEvents, upcomingByYear } =\n    useMemo(() => {\n      const withStatus = events.map((e) => ({\n        raw: e,\n        status: computeStatus(e),\n        start: toDate(e.data.startDate)!,\n        end: toDate(e.data.endDate) ?? toDate(e.data.startDate)!,\n        isFeaturedFlag: !!e.data.featured,\n      }));\n\n      // Current (happening now)\n      const current = withStatus.filter((x) => x.status === \"ongoing\");\n\n      // Future featured-only: featured events with future startDate\n      const featuredOnlyFuture = withStatus.filter(\n        (x) => x.isFeaturedFlag && x.start > now,\n      );\n\n      // Compose featured: all current (even if not flagged featured) + future featured-only\n      // Remove duplicates by id, keeping current events first\n      const featuredMap = new Map<string, (typeof withStatus)[number]>();\n      for (const x of current) featuredMap.set(x.raw.id, x);\n      for (const x of featuredOnlyFuture)\n        if (!featuredMap.has(x.raw.id)) featuredMap.set(x.raw.id, x);\n\n      const featuredEvents = Array.from(featuredMap.values())\n        .sort((a, b) => a.start.getTime() - b.start.getTime())\n        .map((x) => normalizeForCard(x.raw));\n\n      // Upcoming: endDate >= now, sorted by start asc\n      const upcomingEvents = withStatus\n        .filter((x) => x.end >= now)\n        .sort((a, b) => a.start.getTime() - b.start.getTime())\n        .map((x) => normalizeForCard(x.raw));\n\n      // Past: endDate < now, sorted by start desc\n      const pastEvents = withStatus\n        .filter((x) => x.end < now)\n        .sort((a, b) => b.start.getTime() - a.start.getTime())\n        .map((x) => normalizeForCard(x.raw));\n\n      // Group upcoming by year of startDate\n      const upcomingByYear = upcomingEvents.reduce(\n        (acc: Record<string, SerializedEvent[]>, e) => {\n          const y = (e.data.startDate as Date).getFullYear().toString();\n          acc[y] = acc[y] || [];\n          acc[y].push(e);\n          return acc;\n        },\n        {},\n      );\n\n      // Sort each year's events by date asc (already asc, but ensure)\n      Object.keys(upcomingByYear).forEach((year) => {\n        const arr = upcomingByYear[year];\n        if (arr) {\n          arr.sort(\n            (a, b) =>\n              (a.data.startDate as Date).getTime() -\n              (b.data.startDate as Date).getTime(),\n          );\n        }\n      });\n\n      return {\n        featuredEvents,\n        upcomingEvents,\n        pastEvents,\n        upcomingByYear,\n      };\n    }, [events, now]);\n\n  const cls = (...parts: Array<string | false | undefined>) =>\n    parts.filter(Boolean).join(\" \");\n\n  return (\n    <div className={cls(\"flex flex-col gap-10\", className)}>\n      {/* Featured */}\n      {featuredEvents.length > 0 && (\n        <Section\n          id=\"featured\"\n          title=\"Featured Events\"\n          subtitle=\"Highlighted events, including events happening right now\"\n          variant=\"primary\"\n        >\n          <ExpandableGrid\n            items={featuredEvents}\n            initialCount={initialFeaturedCount}\n            viewAllText={`View All ${featuredEvents.length} Featured & Current Events`}\n            renderItem={(e) => (\n              <EventCard key={e.id} eventId={e.id} data={e.data as any} />\n            )}\n          />\n        </Section>\n      )}\n\n      {/* Upcoming */}\n      {upcomingEvents.length > 0 && (\n        <Section\n          id=\"upcoming\"\n          title=\"Upcoming Events\"\n          subtitle=\"Meet with the community at these future gatherings\"\n          variant=\"secondary\"\n        >\n          <div className=\"flex flex-col gap-8\">\n            {Object.keys(upcomingByYear)\n              .sort()\n              .map((year) => (\n                <div key={year} className=\"mb-2\">\n                  <h3 className=\"text-xl md:text-2xl font-semibold mb-4 gradient-brand-text\">\n                    {year}\n                  </h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                    {(upcomingByYear[year] ?? []).map((e) => (\n                      <EventCard\n                        key={e.id}\n                        eventId={e.id}\n                        data={e.data as any}\n                      />\n                    ))}\n                  </div>\n                </div>\n              ))}\n          </div>\n        </Section>\n      )}\n\n      {/* Past */}\n      {pastEvents.length > 0 && (\n        <Section\n          id=\"past\"\n          title=\"Past Events\"\n          subtitle=\"Explore our full archive of previous community events\"\n          variant=\"tertiary\"\n        >\n          <ExpandableGrid\n            items={pastEvents}\n            initialCount={initialPastCount}\n            viewAllText={`View All ${pastEvents.length} Past Events`}\n            renderItem={(e) => (\n              <EventCard key={e.id} eventId={e.id} data={e.data as any} />\n            )}\n          />\n        </Section>\n      )}\n    </div>\n  );\n};\n\nexport default EventsSections;\n"],"names":["ExpandableGrid","items","initialCount","viewAllText","renderItem","expanded","setExpanded","useState","sectionRef","useRef","didMountRef","prevExpandedRef","useEffect","top","jsxs","jsx","item","index","v","EventsSections","eventsPayload","initialFeaturedCount","initialPastCount","className","events","useMemo","now","toDate","d","computeStatus","start","end","normalizeForCard","featuredEvents","upcomingEvents","pastEvents","upcomingByYear","withStatus","e","current","x","featuredOnlyFuture","featuredMap","a","b","acc","y","year","arr","cls","parts","Section","EventCard"],"mappings":"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"}
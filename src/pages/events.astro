---
import BaseHead from "@/components/BaseHead.astro";
import SiteShell from "@/layouts/SiteShell.astro";
import EventsPage from "@/react-pages/events/EventsPage";
import EventsSections from "@/components/events/EventsSections";
import { getAllEvents } from "@/data/events";
import { resolveImageLike } from "@/utils/images";

const meta = {
  title: "Events",
  description:
    "Conferences, workshops, and training events for the human-robot interaction community",
};
const ogImage = "/og/events.png";

const allEvents = await getAllEvents();

const serializeEvents = allEvents.map((event) => ({
  id: event.id,
  data: {
    name: event.data.name,
    displayName: event.data.displayName,
    description: event.data.description,
    type: event.data.type,
    startDate:
      event.data.startDate instanceof Date
        ? event.data.startDate.toISOString()
        : event.data.startDate,
    endDate:
      event.data.endDate instanceof Date
        ? event.data.endDate.toISOString()
        : event.data.endDate,
    featured: event.data.featured,
    links: event.data.links,
    location: event.data.location,
    imagePolicy: event.data.imagePolicy,
    images: {
      hero: resolveImageLike(event.data.images?.hero),
      logo: resolveImageLike(event.data.images?.logo),
    },
  },
}));

const eventsPayload = JSON.stringify(serializeEvents);
---

<html
  class="overflow-x-hidden grid scroll-pt-[72px] scroll-smooth font-sans text-text text-xl md:text-base antialiased"
  lang="en"
>
  <head>
    <BaseHead
      title={meta.title}
      description={meta.description}
      ogImage={ogImage}
    />
  </head>
  <body class="relative min-h-screen w-full bg-surface">
    <SiteShell noPaddingTop showBackground={false}>
      <EventsPage>
        {
          serializeEvents.length > 0 && (
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-0">
              <EventsSections
                client:load
                eventsPayload={eventsPayload}
                initialFeaturedCount={6}
                initialPastCount={6}
              />
            </div>
          )
        }
      </EventsPage>
    </SiteShell>
  </body>
</html>

---
import BaseHead from "@/components/BaseHead.astro";
import SiteShell from "@/layouts/SiteShell.astro";
import ContributorsPage from "@/react-pages/contributors/ContributorsPage";
import { getAllPartners } from "@/data/partners";
import { getAllPeople } from "@/data/people";
import { getCollection } from "astro:content";

const meta = {
  title: "Contributors",
  description:
    "People and organizations advancing human-centered robotics and AI together",
};

const allPartners = await getAllPartners();
const allPeople = await getAllPeople();
const organizations = await getCollection("organizations", ({ data }) =>
  import.meta.env.PROD ? data.draft !== true : true,
);

const orgNameById = Object.fromEntries(
  organizations.map((org) => [org.id, org.data.shortName || org.data.name]),
);

const HIDE_BOARD_MEMBERS = true;
const boardMembers = allPeople.filter(
  (p) => p.data.isContributor && p.data.boardMember,
);
const communityMembers = allPeople.filter(
  (p) =>
    p.data.isContributor && (HIDE_BOARD_MEMBERS ? true : !p.data.boardMember),
);

const donorPeople = allPeople.filter((p) => p.data.isDonor);
const donorOrganizations = organizations.filter((org) => org.data.isDonor);
const donorsCount = donorPeople.length + donorOrganizations.length;
const grantMakers = organizations.filter((org) => org.data.isGrantMaker);

const partnerTypeInfo: Record<
  string,
  { title: string; icon: string; description: string }
> = {
  industry: {
    title: "Industry Partners",
    icon: "solar:buildings-2-line-duotone",
    description: "Companies driving innovation in robotics and AI",
  },
  nonprofit: {
    title: "Non-Profit Partners",
    icon: "solar:hand-shake-line-duotone",
    description: "Organizations advancing social impact through technology",
  },
  academic: {
    title: "Academic Partners",
    icon: "solar:square-academic-cap-line-duotone",
    description: "Leading universities and research institutions",
  },
  government: {
    title: "Government Partners",
    icon: "solar:flag-2-line-duotone",
    description: "Public sector organizations and agencies",
  },
};
const orderedPartnerTypes = ["industry", "nonprofit", "academic", "government"];

const partnersByType: Record<string, typeof allPartners> = {};
for (const partner of allPartners) {
  if (!partnersByType[partner.data.type]) {
    partnersByType[partner.data.type] = [];
  }
  partnersByType[partner.data.type]!.push(partner);
}

const partnerSections = [
  ...orderedPartnerTypes,
  ...Object.keys(partnersByType).filter((type) => !orderedPartnerTypes.includes(type)),
].map((type) => ({
  type,
  info: partnerTypeInfo[type] ?? null,
  partners: partnersByType[type] ?? [],
}));

const sponsorsUniqueCount = (() => {
  const ids = new Set<string>();
  donorPeople.forEach((p) => ids.add(`p:${p.id}`));
  donorOrganizations.forEach((o) => ids.add(`o:${o.id}`));
  grantMakers.forEach((o) => ids.add(`o:${o.id}`));
  return ids.size;
})();
---

<html
  class="overflow-x-hidden grid scroll-pt-[72px] scroll-smooth font-sans text-text text-xl md:text-base antialiased"
  lang="en"
>
  <head>
    <BaseHead title={meta.title} description={meta.description} />
  </head>
  <body class="relative min-h-screen w-full bg-surface">
    <SiteShell noPaddingTop showBackground containerClassName="max-w-6xl">
                        
            <ContributorsPage
              meta={meta}
              hideBoardMembers={HIDE_BOARD_MEMBERS}
              boardMembers={boardMembers}
              communityMembers={communityMembers}
              partnerSections={partnerSections}
              donorPeople={donorPeople}
              donorOrganizations={donorOrganizations}
              grantMakers={grantMakers}
              donorsCount={donorsCount}
              sponsorsUniqueCount={sponsorsUniqueCount}
              orgNameById={orgNameById}
            />
    </SiteShell>
  </body>
</html>

---
import PageLayout from "@/layouts/Base.astro";
import Section from "@/components/Section.astro";
import ItemCard from "@/components/ItemCard.astro";
import FeatureCard from "@/components/FeatureCard.astro";
import CallToActionButton from "@/components/CallToActionButton.astro";
import { Icon } from "astro-icon/components";
import {
  getAllPartners,
  getFeaturedPartners,
  getPartnerCountByType,
  getPartnerCountByCategory,
  getUniquePartnerTypes,
  getUniquePartnerCategories,
} from "@/data/partners";

const meta = {
  title: "Partners",
  description:
    "Academic, industry, and public sector partners advancing human-centered robotics and AI together",
};

// Fetch partners from content collections
const allPartners = await getAllPartners();
const featuredPartners = await getFeaturedPartners();
const partnerTypeCounts = await getPartnerCountByType();
const partnerCategoryCounts = await getPartnerCountByCategory();
const partnerTypes = await getUniquePartnerTypes();
const partnerCategories = await getUniquePartnerCategories();

// Group partners by type for display
const partnersByType: Record<string, typeof allPartners> = {};
for (const partner of allPartners) {
  if (!partnersByType[partner.data.type]) {
    partnersByType[partner.data.type] = [];
  }
  partnersByType[partner.data.type]!.push(partner);
}

// Partner type info for display
const partnerTypeInfo: Record<
  string,
  { title: string; icon: string; description: string }
> = {
  academic: {
    title: "Academic Partners",
    icon: "solar:square-academic-cap-line-duotone",
    description: "Leading universities and research institutions",
  },
  industry: {
    title: "Industry Partners",
    icon: "solar:buildings-2-line-duotone",
    description: "Companies driving innovation in robotics and AI",
  },
  nonprofit: {
    title: "Non-Profit Partners",
    icon: "solar:hand-shake-line-duotone",
    description: "Organizations advancing social impact through technology",
  },
  government: {
    title: "Government Partners",
    icon: "solar:flag-2-line-duotone",
    description: "Public sector organizations and agencies",
  },
  community: {
    title: "Community Partners",
    icon: "solar:users-group-rounded-line-duotone",
    description: "Local and global community organizations",
  },
};

// Partner category info
const categoryInfo: Record<string, { icon: string; color: string }> = {
  research: {
    icon: "solar:test-tube-minimalistic-line-duotone",
    color: "text-blue-500",
  },
  development: {
    icon: "solar:code-2-line-duotone",
    color: "text-green-500",
  },
  education: {
    icon: "solar:book-2-line-duotone",
    color: "text-purple-500",
  },
  funding: {
    icon: "solar:wallet-money-line-duotone",
    color: "text-yellow-500",
  },
  infrastructure: {
    icon: "solar:server-line-duotone",
    color: "text-orange-500",
  },
  outreach: {
    icon: "solar:share-line-duotone",
    color: "text-pink-500",
  },
};

// Transform partner data for ItemCard component
const transformPartner = (partner: any) => {
  // Build category label
  const typeLabel = partner.data.type
    ? partner.data.type.charAt(0).toUpperCase() + partner.data.type.slice(1)
    : "";
  const categoryLabel = partner.data.category
    ? partner.data.category.charAt(0).toUpperCase() +
      partner.data.category.slice(1)
    : "";

  const displayName =
    partner.data.shortName ||
    partner.data.displayName ||
    partner.data.name ||
    "Unnamed Partner";

  return {
    title: displayName,
    type: "partners" as const,
    description: partner.data.description,
    category: [typeLabel, categoryLabel].filter(Boolean).join(" â€¢ "),
    featured: partner.data.featured,
    href: `/partners/${partner.id}`,
    ...(partner.data.logo && { image: partner.data.logo }),
    links: {
      ...(partner.data.website && { website: partner.data.website }),
    },
  };
};

const benefits = [
  {
    icon: "solar:users-group-rounded-line-duotone",
    title: "Community Access",
    description:
      "Connect with a global network of HRI researchers and practitioners",
  },
  {
    icon: "solar:test-tube-minimalistic-line-duotone",
    title: "Research Collaboration",
    description: "Partner on cutting-edge HRI research projects and studies",
  },
  {
    icon: "solar:rocket-line-duotone",
    title: "Innovation Pipeline",
    description: "Access to emerging technologies and research breakthroughs",
  },
  {
    icon: "solar:square-academic-cap-line-duotone",
    title: "Talent Development",
    description: "Build relationships with the next generation of HRI experts",
  },
  {
    icon: "solar:chart-2-line-duotone",
    title: "Market Intelligence",
    description: "Gain insights into HRI trends and opportunities",
  },
  {
    icon: "solar:star-shine-line-duotone",
    title: "Brand Visibility",
    description: "Showcase your organization's commitment to HRI advancement",
  },
];
---

<PageLayout meta={meta}>
  <h1 class="title mb-6">Partners</h1>

  <!-- Hero Section with CTAs -->
  <Section id="partners-cta">
    <div class="max-w-4xl mx-auto text-center mb-12">
      <p class="text-lg mb-8 text-color-600 dark:text-color-400">
        Join a collaborative ecosystem of organizations advancing human-robot
        interaction through shared resources, expertise, and vision.
      </p>

      <!-- CTA Buttons -->
      <div class="flex flex-wrap justify-center gap-4 mb-8">
        <CallToActionButton
          href="#become-partner"
          text="Become a Partner"
          size="large"
        />
        <CallToActionButton
          href="#current-partners"
          text="View Partners"
          size="large"
          variant="secondary"
        />
      </div>

      <!-- Partner Statistics -->
      <div class="flex flex-wrap justify-center gap-6 text-sm">
        <div class="flex items-center gap-2">
          <Icon
            name="solar:buildings-2-line-duotone"
            class="w-4 h-4 text-accent-one"
          />
          <span>{allPartners.length} Partners</span>
        </div>
        {
          partnerTypes.length > 0 && (
            <div class="flex items-center gap-2">
              <Icon
                name="solar:layers-line-duotone"
                class="w-4 h-4 text-accent-two"
              />
              <span>{partnerTypes.length} Sectors</span>
            </div>
          )
        }
        {
          partnerCategories.length > 0 && (
            <div class="flex items-center gap-2">
              <Icon
                name="solar:widget-2-line-duotone"
                class="w-4 h-4 text-special"
              />
              <span>{partnerCategories.length} Areas</span>
            </div>
          )
        }
        <div class="flex items-center gap-2">
          <Icon
            name="solar:global-line-duotone"
            class="w-4 h-4 text-green-500"
          />
          <span>Global Reach</span>
        </div>
      </div>
    </div>
  </Section>

  <!-- Featured Partners -->
  {
    featuredPartners.length > 0 && (
      <Section
        id="featured-partners"
        title="Featured Partners"
        subtitle="Organizations leading the way in HRI innovation"
      >
        <div class="max-w-6xl mx-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {featuredPartners.slice(0, 6).map((partner) => {
              const cardData = transformPartner(partner);
              return <ItemCard {...cardData} />;
            })}
          </div>
        </div>
      </Section>
    )
  }

  <!-- Current Partners by Type -->
  <Section
    id="current-partners"
    title="Our Partners"
    subtitle="Organizations committed to advancing HRI together"
  >
    <div class="max-w-6xl mx-auto">
      {
        partnerTypes.length > 0 ? (
          partnerTypes.map((type) => {
            const partners = partnersByType[type];
            const info = partnerTypeInfo[type];
            if (!partners || partners.length === 0) return null;

            return (
              <div class="mb-10">
                <div class="flex items-center gap-3 mb-6">
                  <Icon
                    name={info?.icon || "solar:folder-line-duotone"}
                    class="w-6 h-6 text-accent-two"
                  />
                  <h3 class="text-xl font-semibold">{info?.title || type}</h3>
                  <span class="text-sm px-2 py-1 bg-accent-one/20 rounded">
                    {partners.length}
                  </span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  {partners.map((partner) => {
                    const cardData = transformPartner(partner);
                    return <ItemCard {...cardData} />;
                  })}
                </div>
              </div>
            );
          })
        ) : (
          <div class="text-center py-12">
            <Icon
              name="solar:buildings-2-line-duotone"
              class="w-24 h-24 mx-auto mb-4 text-color-300"
            />
            <p class="text-lg text-color-600 dark:text-color-400">
              Partner information coming soon! Check back later for updates.
            </p>
          </div>
        )
      }
    </div>
  </Section>

  <!-- Partner Benefits -->
  <Section
    id="benefits"
    title="Partner Benefits"
    subtitle="What you gain by joining our partner network"
  >
    <div class="max-w-6xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
          benefits.map((benefit) => (
            <FeatureCard
              icon={benefit.icon}
              title={benefit.title}
              description={benefit.description}
            />
          ))
        }
      </div>
    </div>
  </Section>

  <!-- Partnership Categories -->
  {
    partnerCategories.length > 0 && (
      <Section
        id="categories"
        title="Partnership Areas"
        subtitle="Multiple ways to collaborate and contribute"
      >
        <div class="max-w-5xl mx-auto">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {partnerCategories.map((category) => {
              const info = categoryInfo[category];
              const count = partnerCategoryCounts[category] || 0;

              return (
                <div class="flex items-start gap-3 p-4 bg-special-lighter rounded-lg border-2 hover:border-accent-two border-accent-one/40 transition-all">
                  <Icon
                    name={info?.icon || "solar:folder-line-duotone"}
                    class={`w-6 h-6 flex-shrink-0 ${info?.color || "text-neutral-500"}`}
                  />
                  <div>
                    <h4 class="font-semibold mb-1 capitalize">{category}</h4>
                    <p class="text-xs text-accent-one mb-1">
                      {count} {count === 1 ? "Partner" : "Partners"}
                    </p>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </Section>
    )
  }

  <!-- Become a Partner -->
  <Section
    id="become-partner"
    title="Become a Partner"
    subtitle="Join us in shaping the future of human-robot interaction"
  >
    <div class="max-w-4xl mx-auto">
      <div
        class="bg-gradient-to-r from-accent-one/10 to-accent-two/10 rounded-lg p-8 border border-accent-one/20"
      >
        <h3 class="text-2xl font-semibold mb-4 text-center gradient-brand-text">
          Partnership Opportunities
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div class="text-center">
            <div
              class="w-12 h-12 mx-auto mb-3 rounded-full bg-accent-one/20 flex items-center justify-center"
            >
              <Icon
                name="solar:test-tube-minimalistic-line-duotone"
                class="w-6 h-6 text-accent-one"
              />
            </div>
            <h4 class="font-semibold mb-1">Research</h4>
            <p class="text-xs text-color-600 dark:text-color-400">
              Collaborate on groundbreaking studies
            </p>
          </div>

          <div class="text-center">
            <div
              class="w-12 h-12 mx-auto mb-3 rounded-full bg-accent-two/20 flex items-center justify-center"
            >
              <Icon
                name="solar:dollar-line-duotone"
                class="w-6 h-6 text-accent-two"
              />
            </div>
            <h4 class="font-semibold mb-1">Funding</h4>
            <p class="text-xs text-color-600 dark:text-color-400">
              Support HRI research and development
            </p>
          </div>

          <div class="text-center">
            <div
              class="w-12 h-12 mx-auto mb-3 rounded-full bg-special/40 flex items-center justify-center"
            >
              <Icon
                name="solar:presentation-graph-line-duotone"
                class="w-6 h-6 text-special-darkest"
              />
            </div>
            <h4 class="font-semibold mb-1">Resources</h4>
            <p class="text-xs text-color-600 dark:text-color-400">
              Share expertise and infrastructure
            </p>
          </div>
        </div>

        <p class="text-center mb-6 text-color-600 dark:text-color-400">
          Whether you're an academic institution, industry leader, or community
          organization, there's a place for you in our partner network.
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <CallToActionButton
            href="/get-involved"
            text="Partner With Us"
            size="large"
          />
          <CallToActionButton
            href="/about"
            text="Learn More"
            size="large"
            variant="tertiary"
          />
        </div>
      </div>
    </div>
  </Section>
</PageLayout>
